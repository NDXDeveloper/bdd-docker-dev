# Configuration basique de MariaDB avec Docker Compose

üîù Retour au [Sommaire](/SOMMAIRE.md)

---

## üìã Introduction

Cette fiche vous guide pas √† pas pour d√©ployer une instance MariaDB fonctionnelle avec Docker Compose. MariaDB est une base de donn√©es relationnelle (SQL) compatible avec MySQL, id√©ale pour le d√©veloppement d'applications web.

**Ce que vous allez apprendre :**
- Cr√©er un fichier `docker-compose.yml` pour MariaDB
- D√©marrer et arr√™ter votre base de donn√©es
- Vous connecter √† MariaDB depuis votre machine
- G√©rer la persistance des donn√©es

**Dur√©e estim√©e :** 10 minutes

---

## üéØ Pr√©requis

Avant de commencer, assurez-vous d'avoir :

- ‚úÖ Docker install√© sur votre machine ([Guide d'installation](https://docs.docker.com/get-docker/))
- ‚úÖ Docker Compose install√© (inclus avec Docker Desktop)
- ‚úÖ Un √©diteur de texte (VS Code, Notepad++, nano, vim...)
- ‚úÖ Des connaissances basiques du terminal/ligne de commande

**V√©rification rapide :**

```bash
# V√©rifier que Docker fonctionne
docker --version

# V√©rifier Docker Compose
docker-compose --version
```

Si ces commandes affichent un num√©ro de version, vous √™tes pr√™t !

---

## üìù √âtape 1 : Cr√©er le fichier docker-compose.yml

### 1.1 Cr√©er un dossier pour votre projet

Cr√©ez un nouveau dossier pour organiser vos fichiers :

```bash
# Cr√©er le dossier
mkdir mariadb-docker

# Se d√©placer dans le dossier
cd mariadb-docker
```

### 1.2 Cr√©er le fichier de configuration

Cr√©ez un fichier nomm√© `docker-compose.yml` dans ce dossier avec le contenu suivant :

```yaml
version: '3.8'

services:
  mariadb:
    # Image officielle MariaDB (version 10.11)
    image: mariadb:10.11

    # Nom du conteneur (facilite les commandes)
    container_name: mariadb_dev

    # Red√©marrage automatique sauf si arr√™t manuel
    restart: unless-stopped

    # Variables d'environnement
    environment:
      # ‚ö†Ô∏è IMPORTANT : Changez ce mot de passe !
      MYSQL_ROOT_PASSWORD: mon_mot_de_passe_securise

      # Optionnel : Cr√©er une base de donn√©es au d√©marrage
      MYSQL_DATABASE: ma_base_dev

      # Optionnel : Cr√©er un utilisateur (en plus de root)
      MYSQL_USER: dev_user
      MYSQL_PASSWORD: mot_de_passe_user

    # Exposition du port
    ports:
      # Format : port_hote:port_conteneur
      - "3306:3306"

    # Volume pour la persistance des donn√©es
    volumes:
      - mariadb_data:/var/lib/mysql

# D√©claration du volume
volumes:
  mariadb_data:
    # Volume g√©r√© par Docker (donn√©es persistantes)
```

### üìñ Explication du fichier

| Section | R√¥le |
|---------|------|
| `version: '3.8'` | Version du format Docker Compose |
| `services:` | Liste des conteneurs √† cr√©er |
| `image: mariadb:10.11` | Image Docker √† utiliser (version 10.11 de MariaDB) |
| `container_name:` | Nom personnalis√© du conteneur |
| `restart: unless-stopped` | Le conteneur red√©marre automatiquement (sauf si vous l'arr√™tez) |
| `environment:` | Variables de configuration |
| `ports:` | Correspondance des ports (permet l'acc√®s depuis votre PC) |
| `volumes:` | Stockage persistant des donn√©es |

**üí° Comprendre les variables d'environnement :**

- `MYSQL_ROOT_PASSWORD` : Mot de passe du super-administrateur (obligatoire)
- `MYSQL_DATABASE` : Nom d'une base de donn√©es cr√©√©e automatiquement (optionnel)
- `MYSQL_USER` : Nom d'un utilisateur suppl√©mentaire (optionnel)
- `MYSQL_PASSWORD` : Mot de passe de cet utilisateur (optionnel)

---

## ‚ñ∂Ô∏è √âtape 2 : D√©marrer MariaDB

### 2.1 Lancer le conteneur

Dans votre terminal, depuis le dossier contenant le `docker-compose.yml`, ex√©cutez :

```bash
docker-compose up -d
```

**Signification de la commande :**
- `up` : Cr√©er et d√©marrer les conteneurs
- `-d` : Mode "detached" (en arri√®re-plan)

**Ce qui se passe :**
1. Docker t√©l√©charge l'image MariaDB (si premi√®re utilisation)
2. Cr√©ation du conteneur `mariadb_dev`
3. Cr√©ation du volume `mariadb_data`
4. D√©marrage de MariaDB

### 2.2 V√©rifier que tout fonctionne

```bash
# Voir les conteneurs en cours d'ex√©cution
docker-compose ps

# Vous devriez voir quelque chose comme :
#     Name                Command             State          Ports
# --------------------------------------------------------------------
# mariadb_dev   docker-entrypoint.sh ...   Up      0.0.0.0:3306->3306/tcp
```

Si le `State` est `Up`, f√©licitations, votre base de donn√©es est lanc√©e ! üéâ

---

## üîå √âtape 3 : Se connecter √† MariaDB

### 3.1 Connexion depuis le terminal

Vous pouvez vous connecter directement au shell MariaDB du conteneur :

```bash
# Se connecter en tant que root
docker exec -it mariadb_dev mariadb -u root -p
```

**D√©tail de la commande :**
- `docker exec` : Ex√©cuter une commande dans un conteneur
- `-it` : Mode interactif avec terminal
- `mariadb_dev` : Nom du conteneur
- `mariadb -u root -p` : Commande MariaDB (se connecter en tant que root)

Entrez le mot de passe (`MYSQL_ROOT_PASSWORD` d√©fini dans votre `docker-compose.yml`).

**Une fois connect√©, vous pouvez tester :**

```sql
-- Afficher les bases de donn√©es
SHOW DATABASES;

-- Utiliser votre base de donn√©es (si cr√©√©e)
USE ma_base_dev;

-- Cr√©er une table de test
CREATE TABLE test (
    id INT PRIMARY KEY AUTO_INCREMENT,
    nom VARCHAR(100)
);

-- Ins√©rer des donn√©es
INSERT INTO test (nom) VALUES ('Premier test');

-- Afficher les donn√©es
SELECT * FROM test;

-- Quitter
EXIT;
```

### 3.2 Connexion depuis un client graphique

Vous pouvez utiliser des outils comme :
- **DBeaver** (gratuit, multi-plateformes)
- **HeidiSQL** (gratuit, Windows)
- **MySQL Workbench** (gratuit, multi-plateformes)
- **DataGrip** (payant, JetBrains)

**Param√®tres de connexion :**

| Param√®tre | Valeur |
|-----------|--------|
| H√¥te | `localhost` ou `127.0.0.1` |
| Port | `3306` |
| Utilisateur | `root` (ou `dev_user` si cr√©√©) |
| Mot de passe | Celui d√©fini dans `docker-compose.yml` |
| Base de donn√©es | `ma_base_dev` (ou autre) |

---

## üíæ √âtape 4 : Comprendre la persistance des donn√©es

### 4.1 Qu'est-ce qu'un volume Docker ?

Les volumes Docker permettent de **sauvegarder les donn√©es** m√™me quand le conteneur est supprim√©.

**Dans notre configuration :**
```yaml
volumes:
  - mariadb_data:/var/lib/mysql
```

- `mariadb_data` : Nom du volume (g√©r√© par Docker)
- `/var/lib/mysql` : Emplacement des donn√©es dans le conteneur

### 4.2 V√©rifier les volumes

```bash
# Lister les volumes
docker volume ls

# Inspecter un volume
docker volume inspect mariadb_data
```

### 4.3 O√π sont stock√©es les donn√©es ?

Les donn√©es sont stock√©es dans un emplacement g√©r√© par Docker :
- **Linux :** `/var/lib/docker/volumes/`
- **Windows/Mac (Docker Desktop) :** Dans la VM de Docker Desktop

**üí° Important :** Vous n'avez pas besoin d'acc√©der directement √† cet emplacement. Docker g√®re tout pour vous !

---

## üõë √âtape 5 : G√©rer le conteneur

### 5.1 Commandes utiles

```bash
# Voir les logs en temps r√©el
docker-compose logs -f

# Arr√™ter le conteneur (les donn√©es sont conserv√©es)
docker-compose stop

# Red√©marrer le conteneur
docker-compose start

# Red√©marrer apr√®s modification du docker-compose.yml
docker-compose restart

# Arr√™ter ET supprimer le conteneur (les donn√©es restent dans le volume)
docker-compose down

# Supprimer conteneur ET volume (‚ö†Ô∏è SUPPRIME TOUTES LES DONN√âES)
docker-compose down -v
```

### 5.2 Cycle de vie typique

```bash
# Premier lancement
docker-compose up -d

# Travailler avec la BDD...

# Arr√™t pour la nuit
docker-compose stop

# Relance le lendemain
docker-compose start

# Nettoyage complet (fin de projet)
docker-compose down -v
```

---

## üßπ √âtape 6 : Nettoyage complet (optionnel)

Si vous souhaitez tout supprimer proprement :

```bash
# 1. Arr√™ter et supprimer le conteneur
docker-compose down

# 2. Supprimer le volume (‚ö†Ô∏è SUPPRIME LES DONN√âES)
docker volume rm mariadb_data

# 3. Supprimer l'image (optionnel, pour lib√©rer de l'espace)
docker rmi mariadb:10.11
```

---

## ‚úÖ R√©capitulatif

Vous avez appris √† :

- ‚úÖ Cr√©er un fichier `docker-compose.yml` pour MariaDB
- ‚úÖ D√©marrer et arr√™ter votre base de donn√©es
- ‚úÖ Vous connecter via terminal ou client graphique
- ‚úÖ Comprendre la persistance des donn√©es avec les volumes
- ‚úÖ G√©rer le cycle de vie du conteneur

**Fichiers cr√©√©s :**
- `docker-compose.yml` : Configuration du service
- Volume `mariadb_data` : Stockage des donn√©es (g√©r√© par Docker)

---

## üöÄ Prochaines √©tapes

Maintenant que vous ma√Ætrisez la configuration basique, vous pouvez explorer :

- **[1.2 Configuration avec fichier my.cnf](02-config-avec-mycnf.md)** - Personnaliser la configuration MariaDB
- **[1.3 Configuration avec IP fixe](03-config-ip-fixe.md)** - Assigner une adresse IP statique au conteneur
- **[1.4 Gestion des utilisateurs](04-gestion-utilisateurs.md)** - Cr√©er et g√©rer les utilisateurs SQL
- **[1.5 Acc√®s r√©seau local](05-acces-reseau-local.md)** - Permettre l'acc√®s depuis d'autres machines

---

## üìö Ressources compl√©mentaires

- [Documentation officielle MariaDB](https://mariadb.org/documentation/)
- [Documentation Docker Compose](https://docs.docker.com/compose/)
- [Image Docker MariaDB](https://hub.docker.com/_/mariadb)

---

## ‚ùì FAQ - Questions fr√©quentes

**Q : Puis-je utiliser une autre version de MariaDB ?**
R : Oui, remplacez `mariadb:10.11` par `mariadb:11.2` (ou autre version disponible sur [Docker Hub](https://hub.docker.com/_/mariadb/tags)).

**Q : Pourquoi utiliser Docker plut√¥t qu'installer MariaDB directement ?**
R : Docker permet l'isolation (pas de conflit avec d'autres versions), la portabilit√© (m√™me config partout) et le nettoyage facile (suppression propre).

**Q : Le port 3306 est d√©j√† utilis√© sur ma machine, que faire ?**
R : Changez le port h√¥te dans `docker-compose.yml` : `"3307:3306"` (utilisez le port 3307 sur votre machine).

**Q : Comment sauvegarder ma base de donn√©es ?**
R : Utilisez `mysqldump` depuis le conteneur :
```bash
docker exec mariadb_dev mysqldump -u root -p ma_base_dev > backup.sql
```

**Q : Comment restaurer une sauvegarde ?**
R : Copiez le fichier SQL dans le conteneur et importez-le :
```bash
docker cp backup.sql mariadb_dev:/backup.sql
docker exec -it mariadb_dev mariadb -u root -p ma_base_dev < /backup.sql
```

---

üîù Retour au [Sommaire](/SOMMAIRE.md)
